---
title: Getting started
sidebar_position: 1
hide_title: true
---

import CodeBlock from "@theme/CodeBlock";

<h1>
  {frontMatter.title} <TierLabel tiers="enterprise" />
</h1>

## Getting Started with CAPI

### Creating your first CAPD Cluster

If you've followed the [Upgrade guide](../enterprise/upgrading.mdx) you should have a management cluster ready to roll. Next up we'll

#### 1. Configure a capi provider

1. Configure `kubectl` to use the management cluster.

```bash
export KUBECONFIG=/path/to/kubeconfig
```

2. Deploy Docker's CAPD components by following the steps at https://cluster-api-aws.sigs.k8s.io/getting-started.html#install-clusterctl.

> **_NOTE:_** if you are using docker with a `kind` cluster you'll need to mount the docker socket as described in the [Install and/or configure a kubernetes cluster](https://cluster-api-aws.sigs.k8s.io/getting-started.html#install-andor-configure-a-kubernetes-cluster) kind section.

3. Enable an expermintal feature (i.e. ClusterResourceSet (CRS)).

```bash
export EXP_CLUSTER_RESOURCE_SET=true

clusterctl init --infrastructure docker
```

See [Cluster API Providers](cluster-api-providers.mdx) page for more details on other providers.

#### 2. Add a template

import CapdTemplate from "!!raw-loader!./assets/templates/capd-template.yaml";

Download the template below to your config repository path with curl

<CodeBlock className="language-bash">
  curl -o .weave-gitops/apps/capi/templates/capd-template.yaml{" "}
  {window.location.protocol}//{window.location.host}
  {require("./assets/templates/capd-template.yaml").default}
</CodeBlock>

<CodeBlock
  title=".weave-gitops/apps/capi/templates/capd-template.yaml"
  className="language-yaml"
>
  {CapdTemplate}
</CodeBlock>

See [CAPI Templates](templates.mdx) page for more details.

#### 3. Add a helmrepo and annotate some helm charts

import ProfileRepo from "!!raw-loader!./assets/profiles/profile-repo.yaml";

Download the profile repositry below to your config repository path with curl

<CodeBlock className="language-bash">
  mkdir -p .weave-gitops/apps/capi/profiles{"\n"}
  curl -o .weave-gitops/apps/capi/profiles/profile-repo.yaml {
    window.location.protocol
  }
  //{window.location.host}
  {require("./assets/profiles/profile-repo.yaml").default}
</CodeBlock>

<CodeBlock
  title=".weave-gitops/apps/capi/profiles/profile-repo.yaml"
  className="language-yaml"
>
  {ProfileRepo}
</CodeBlock>

#### 4. Add a CRS to install a CNI

Create a calico configmap and a CRS as follows:

import CalicoCRS from "!!raw-loader!./assets/bootstrap/calico-crs.yaml";

<CodeBlock className="language-bash">
  mkdir -p .weave-gitops/apps/capi/bootstrap{"\n"}
  curl -o .weave-gitops/apps/capi/bootstrap/calico-crs.yaml {
    window.location.protocol
  }
  //{window.location.host}
  {"\n"}
  curl -o .weave-gitops/apps/capi/bootstrap/calico-crs-configmap.yaml{" "}
  {window.location.protocol}
  //{window.location.host}
  {require("./assets/bootstrap/calico-crs-configmap.yaml").default}
</CodeBlock>

<CodeBlock
  title=".weave-gitops/apps/capi/boostrap/calico-crs.yaml"
  className="language-yaml"
>
  {CalicoCRS}
</CodeBlock>

The full [`calico-crs-configmap.yaml`](./assets/bootstrap/calico-crs-configmap.yaml) is a bit large to display inline here.

#### 5. Add a cluster bootstrap config

Create a cluster bootstrap config as follows:

```bash
 kubectl create secret generic my-pat --from-literal GITHUB_TOKEN=$GITHUB_TOKEN
```

import CapiGitopsCDC from "!!raw-loader!./assets/bootstrap/capi-gitops-cluster-bootstrap-config.yaml";

Download the config with

<CodeBlock className="language-bash">
  mkdir -p .weave-gitops/apps/capi/bootstrap{"\n"}
  curl -o .weave-gitops/apps/capi/bootstrap/capi-gitops-cluster-bootstrap-config.yaml{" "}
  {window.location.protocol}
  //{window.location.host}
  {
    require("./assets/bootstrap/capi-gitops-cluster-bootstrap-config.yaml")
      .default
  }
</CodeBlock>

Then update the `GITOPS_REPO` variable to point to your cluster

<CodeBlock
  title=".weave-gitops/apps/capi/boostrap/capi-gitops-cluster-bootstrap-config.yaml"
  className="language-yaml"
>
  {CapiGitopsCDC}
</CodeBlock>
