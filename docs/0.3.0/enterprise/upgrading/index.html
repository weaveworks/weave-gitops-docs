<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RD8E3F9BEH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RD8E3F9BEH",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Weave GitOps" href="/opensearch.xml"><title data-react-helmet="true">Upgrading | Weave GitOps</title><meta data-react-helmet="true" property="og:url" content="https://docs.gitops.weave.works//docs/0.3.0/enterprise/upgrading"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="0.3.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-0.3.0"><meta data-react-helmet="true" property="og:title" content="Upgrading | Weave GitOps"><meta data-react-helmet="true" name="description" content="How to: Upgrade to Weave Gitops Enterprise"><meta data-react-helmet="true" property="og:description" content="How to: Upgrade to Weave Gitops Enterprise"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon_150px.png"><link data-react-helmet="true" rel="canonical" href="https://docs.gitops.weave.works//docs/0.3.0/enterprise/upgrading"><link data-react-helmet="true" rel="alternate" href="https://docs.gitops.weave.works//docs/0.3.0/enterprise/upgrading" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.gitops.weave.works//docs/0.3.0/enterprise/upgrading" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.5eca8642.css">
<link rel="preload" href="/assets/js/runtime~main.cf8525d1.js" as="script">
<link rel="preload" href="/assets/js/main.193f1f59.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/weave-logo.png" alt="Weave GitOps Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/weave-logo.png" alt="Weave GitOps Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Weave GitOps</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/0.3.0/intro">Introduction</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/0.3.0/installation">Installation</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/0.3.0/getting-started">Getting Started</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/0.3.0/aws-marketplace">AWS Marketplace</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/0.3.0/intro">0.3.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/enterprise/upgrading">main</a></li><li><a class="dropdown__link" href="/docs/enterprise/upgrading">0.5.0</a></li><li><a class="dropdown__link" href="/docs/0.4.1/enterprise/upgrading">0.4.1</a></li><li><a class="dropdown__link" href="/docs/0.4.0/enterprise/upgrading">0.4.0</a></li><li><a class="dropdown__link" href="/docs/0.3.3/enterprise/upgrading">0.3.3</a></li><li><a class="dropdown__link" href="/docs/0.3.1/enterprise/upgrading">0.3.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.3.0/enterprise/upgrading">0.3.0</a></li><li><a class="dropdown__link" href="/docs/0.2.5/intro">0.2.5</a></li><li><a class="dropdown__link" href="/docs/0.2.4/intro">0.2.4</a></li><li><a class="dropdown__link" href="/docs/0.2.2/intro">0.2.2</a></li><li><a class="dropdown__link" href="/docs/0.2.1/intro">0.2.1</a></li><li><a class="dropdown__link" href="/docs/0.2.0/intro">0.2.0</a></li><li><a class="dropdown__link" href="/docs/0.0.5/intro">0.0.5</a></li></ul></div><a href="https://github.com/weaveworks/weave-gitops" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/weave-logo.png" alt="Weave GitOps Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/weave-logo.png" alt="Weave GitOps Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Weave GitOps</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/0.3.0/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/0.3.0/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/0.3.0/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/0.3.0/aws-marketplace">AWS Marketplace</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/enterprise/upgrading">main</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/enterprise/upgrading">0.5.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.4.1/enterprise/upgrading">0.4.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.4.0/enterprise/upgrading">0.4.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.3/enterprise/upgrading">0.3.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.1/enterprise/upgrading">0.3.1</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/0.3.0/enterprise/upgrading">0.3.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.2.5/intro">0.2.5</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.2.4/intro">0.2.4</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.2.2/intro">0.2.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.2.1/intro">0.2.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.2.0/intro">0.2.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.0.5/intro">0.0.5</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/weaveworks/weave-gitops" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/installation">Installing the CLI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/cli-reference">CLI Reference</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/troubleshooting">Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/aws-marketplace">AWS Marketplace</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/examples/sock-shop">Deploying the Sock Shop Application</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.3.0/gitops-automation">GitOps Automation Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/managing-existing-clusters">Managing existing clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/cluster-api-providers">Cluster API Providers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/templates">CAPI Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/provider-identities">CAPI Provider Identities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/deleting-a-cluster">Deleting a Cluster</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/cli/cli-clusters">Clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.3.0/cluster-management/cli/cli-templates">Templates</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Enterprise</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.3.0/enterprise/intro">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/0.3.0/enterprise/upgrading">Upgrading</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Weave GitOps <b>0.3.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/enterprise/upgrading">latest version</a></b> (0.5.0).</div></div><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 0.3.0</span><div class="markdown"><header><h1 class="h1Heading_27L5">Upgrading</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-upgrade-to-weave-gitops-enterprise"></a>How to: Upgrade to Weave Gitops Enterprise<a class="hash-link" href="#how-to-upgrade-to-weave-gitops-enterprise" title="Direct link to heading">#</a></h2><p>Upgrading requires we:</p><ol><li>Already have Weave GitOps <a href="/docs/0.3.0/getting-started">installed on the cluster</a></li><li>Choose a database</li><li>Create a secret for docker repository</li><li>Create a secret for creating pull requests on your git provider</li><li>Determine the public IP address of the worker nodes</li><li>Install the helm chart</li><li>Check that Weave Gitops Enterprise has been installed (optional)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-choosing-a-database"></a>2. Choosing a database<a class="hash-link" href="#2-choosing-a-database" title="Direct link to heading">#</a></h3><p>WGE stores incoming data from the connected clusters to a relational database. It supports <strong>SQLite</strong> and <strong>PostgreSQL</strong>.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">SQLite on a persistent volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">PostgreSQL</li></ul><div class="margin-vert--md"><div role="tabpanel" hidden=""><p>If your cluster supports persistent volume storage and has a storage class defined, you can use it to request a persistent volume for the SQLite database file. The exact details of the persistent volume request vary by cluster type and the supported volume types. The following manifest is an example of a configuration of a <code>PersistentVolumeClaim</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> PersistentVolumeClaim</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> wge</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">volume</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> wego</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 100G</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumeMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Filesystem</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><p>Using a PostgreSQL database does not require any additional setup on the cluster side. The following details are however needed in order to connect:</p><ul><li>Database server hostname</li><li>Database name</li><li>Database user - The database user requires admin privileges on the database server as it will automatically create the necessary schema.</li><li>Database password</li></ul><p>The database credentials (user and password) need to be provided separately, before
installing the chart, as a secret. Run the following command to create a secret:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create secret generic wge-db-credentials </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace wego-system </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">username</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">database-user</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">password</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">database-password</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-creating-a-secret-for-docker-repository"></a>3. Creating a secret for docker repository<a class="hash-link" href="#3-creating-a-secret-for-docker-repository" title="Direct link to heading">#</a></h3><p>Create a secret that contains your docker repository credentials. This secret will be used by Kubernetes during deployment in order to pull down the WGE images. You can find instructions on how to generate this secret <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/" target="_blank" rel="noopener noreferrer">here</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create secret docker-registry </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace wego-system docker-io-pull-secret </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --docker-username</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your-docker-username</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --docker-password</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your-docker-password</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you use a secrets management solution such as Sealed Secrets follow their instructions on how to create a new secret.</p><p>Take note of the secret name as you will need to supply it later when installing the chart.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-create-a-secret-for-creating-pull-requests-on-your-git-provider"></a>4. Create a secret for creating pull requests on your git provider<a class="hash-link" href="#4-create-a-secret-for-creating-pull-requests-on-your-git-provider" title="Direct link to heading">#</a></h3><p>A Personal Access Token is required for the WGE to create pull requests for new clusters. These tokens need certain permissions (scopes) set. For</p><ul><li>GitHub: <code>repo</code></li><li>GitLab: <code>api</code></li></ul><p>Save the token in secret called <code>git-provider-credentials</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create secret generic git-provider-credentials </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">wego-system</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GIT_PROVIDER_TOKEN=</span><span class="token string variable" style="color:rgb(191, 199, 213)">$GITHUB_TOKEN</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-determining-the-public-ip-address-of-the-worker-nodes"></a>5. Determining the public IP address of the worker nodes<a class="hash-link" href="#5-determining-the-public-ip-address-of-the-worker-nodes" title="Direct link to heading">#</a></h3><p>You need to determine the public IP address of the worker nodes of your cluster. This IP address is necessary in order to establish connectivity between agents and your WGE instance. The way to determine this depends on your cluster type and provisioning method. Take note of that IP address as you will need to supply it later when installing the chart.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">kind clusters</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Other cloud providers</li></ul><div class="margin-vert--md"><div role="tabpanel" hidden=""><p>Get the local IP for kind:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">INGRESS_ADDRESS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$(</span><span class="token variable" style="color:rgb(191, 199, 213)">ipconfig getifaddr en0</span><span class="token variable" style="color:rgb(191, 199, 213)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><p>For other cluster providers you&#x27;ll have to configure the ingress around what they provide.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">INGRESS_ADDRESS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">wge.example.com</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-installing-the-helm-chart"></a>6. Installing the Helm chart<a class="hash-link" href="#6-installing-the-helm-chart" title="Direct link to heading">#</a></h3><p>Before installing the chart, you need to add the Helm chart repository and then update its local cache. Run the following commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm repo </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> wkpv3 https://s3.us-east-1.amazonaws.com/weaveworks-wkp/charts-v3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkpv3&quot;</span><span class="token plain"> has been added to your repositories</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm repo update</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Hang tight </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> we grab the latest from your chart repositories</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.Successfully got an update from the </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkpv3&quot;</span><span class="token plain"> chart repository</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Update Complete. âŽˆHappy Helming</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">âŽˆ</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally install the Helm chart to the target namespace by executing the following command using the Helm CLI (&gt;= <code>v3.5.4</code>).</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">SQLite on a persistent volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">PostgreSQL</li></ul><div class="margin-vert--md"><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> mccp wkpv3/mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --version </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">chart-version</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace wego-system </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;imagePullSecrets[0].name=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseType=sqlite&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sqliteConfig.persistentVolumeClaim=true&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;agentTemplate.natsURL=</span><span class="token string variable" style="color:rgb(191, 199, 213)">$INGRESS_ADDRESS</span><span class="token string" style="color:rgb(195, 232, 141)">:&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nats.client.service.nodePort=&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkp-ui.image.pullSecrets[0]=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.repositoryURL=https://github.com/example/management-repo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.baseBranch=main&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> mccp wkpv3/mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --version </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">chart-version</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace wego-system </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;imagePullSecrets[0].name=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseType=postgres&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseURI=&lt;database-server-hostname&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;postgresConfig.databaseName=&lt;database-name&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;agentTemplate.natsURL=</span><span class="token string variable" style="color:rgb(191, 199, 213)">$INGRESS_ADDRESS</span><span class="token string" style="color:rgb(195, 232, 141)">:&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nats.client.service.nodePort=&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkp-ui.image.pullSecrets[0]=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.repositoryURL=https://github.com/example/management-repo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.baseBranch=main&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By default, connections to PostgreSQL will use port 5432.</p></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="7-checking-that-wge-is-installed-optional"></a>7. Checking that WGE is installed (optional)<a class="hash-link" href="#7-checking-that-wge-is-installed-optional" title="Direct link to heading">#</a></h3><p>You should now be able to load the WGE UI by running the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl port-forward --namespace wego-system deployments.apps/mccp-nginx-ingress-controller </span><span class="token number" style="color:rgb(247, 140, 108)">8000</span><span class="token plain">:80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The WGE UI should now be accessible at <code>http://localhost:8000</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-install-the-mccp-cli"></a>How to: Install the MCCP CLI<a class="hash-link" href="#how-to-install-the-mccp-cli" title="Direct link to heading">#</a></h2><p>The MCCP CLI allows you to interact with Weave GitOps Enterprise management clusters. You can use <code>mccp</code> to manage the lifecycle of your infrastructure declaratively using GitOps. The latest version of the MCCP CLI is available in the following links:</p><ul><li><a href="https://weaveworks-wkp.s3.amazonaws.com/mccp-master-linux-amd64" target="_blank" rel="noopener noreferrer">Linux</a></li><li><a href="https://weaveworks-wkp.s3.amazonaws.com/mccp-master-darwin-amd64" target="_blank" rel="noopener noreferrer">macOS</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/weaveworks/weave-gitops-docs/edit/main/versioned_docs/version-0.3.0/enterprise/upgrading.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/0.3.0/enterprise/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-upgrade-to-weave-gitops-enterprise" class="table-of-contents__link">How to: Upgrade to Weave Gitops Enterprise</a><ul><li><a href="#2-choosing-a-database" class="table-of-contents__link">2. Choosing a database</a></li><li><a href="#3-creating-a-secret-for-docker-repository" class="table-of-contents__link">3. Creating a secret for docker repository</a></li><li><a href="#4-create-a-secret-for-creating-pull-requests-on-your-git-provider" class="table-of-contents__link">4. Create a secret for creating pull requests on your git provider</a></li><li><a href="#5-determining-the-public-ip-address-of-the-worker-nodes" class="table-of-contents__link">5. Determining the public IP address of the worker nodes</a></li><li><a href="#6-installing-the-helm-chart" class="table-of-contents__link">6. Installing the Helm chart</a></li><li><a href="#7-checking-that-wge-is-installed-optional" class="table-of-contents__link">7. Checking that WGE is installed (optional)</a></li></ul></li><li><a href="#how-to-install-the-mccp-cli" class="table-of-contents__link">How to: Install the MCCP CLI</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items"><li class="footer__item"><a href="mailto:support@weave.works" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Contact Us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Weaveworks</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cf8525d1.js"></script>
<script src="/assets/js/main.193f1f59.js"></script>
</body>
</html>